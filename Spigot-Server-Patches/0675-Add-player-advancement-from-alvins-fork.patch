From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Holden Hoover <holdenrosshoover@gmail.com>
Date: Wed, 10 Feb 2021 07:34:17 -0400
Subject: [PATCH] Add player advancement from alvins fork


diff --git a/src/main/java/net/minecraft/server/Advancement.java b/src/main/java/net/minecraft/server/Advancement.java
index c405047c00d354bbc1449fd2f917b73f980ef1a5..ff014207659372937d8081e3890ba652ca071a73 100644
--- a/src/main/java/net/minecraft/server/Advancement.java
+++ b/src/main/java/net/minecraft/server/Advancement.java
@@ -116,6 +116,10 @@ public class Advancement {
         return this.chatComponent;
     }
 
+    public AdvancementDisplay getAdvancementDisplay() {
+        return this.display;
+    }
+
     public static class SerializedAdvancement {
 
         private MinecraftKey a;
diff --git a/src/main/java/net/minecraft/server/AdvancementDataPlayer.java b/src/main/java/net/minecraft/server/AdvancementDataPlayer.java
index c680319e4040be2b60795b22a5e65d6444cc67ed..d74bcc9710a622e39c666f28c147951aa3b49d84 100644
--- a/src/main/java/net/minecraft/server/AdvancementDataPlayer.java
+++ b/src/main/java/net/minecraft/server/AdvancementDataPlayer.java
@@ -30,6 +30,8 @@ import java.util.Set;
 import java.util.stream.Collectors;
 import java.util.stream.Stream;
 import javax.annotation.Nullable;
+
+import io.papermc.paper.adventure.PaperAdventure;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 
@@ -294,7 +296,11 @@ public class AdvancementDataPlayer {
             this.j.add(advancement);
             flag = true;
             if (!flag1 && advancementprogress.isDone()) {
-                this.player.world.getServer().getPluginManager().callEvent(new org.bukkit.event.player.PlayerAdvancementDoneEvent(this.player.getBukkitEntity(), advancement.bukkit)); // CraftBukkit
+                boolean announceToChat = advancement.getAdvancementDisplay() != null && advancement.getAdvancementDisplay().i();
+                net.kyori.adventure.text.Component message = announceToChat ? PaperAdventure.asAdventure(new ChatMessage("chat.type.advancement." + advancement.getAdvancementDisplay().e().a(), this.player.getScoreboardDisplayName(), advancement.j())) : null;
+                org.bukkit.event.player.PlayerAdvancementDoneEvent event = new org.bukkit.event.player.PlayerAdvancementDoneEvent(this.player.getBukkitEntity(), advancement.bukkit, message);
+                this.player.world.getServer().getPluginManager().callEvent(event);
+                message = event.message();
                 advancement.d().a(this.player);
                 if (advancement.c() != null && advancement.c().i() && this.player.world.getGameRules().getBoolean(GameRules.ANNOUNCE_ADVANCEMENTS)) {
                     this.e.sendMessage(new ChatMessage("chat.type.advancement." + advancement.c().e().a(), new Object[]{this.player.getScoreboardDisplayName(), advancement.j()}), ChatMessageType.SYSTEM, SystemUtils.b);
